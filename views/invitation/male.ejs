<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimal-ui" />
  <title> Kính mời <%= (data.invitee !==null) ? data.invitee.name : "" %>
  </title>

  <meta proeperty="og:url" content="https://longdev.io.vn" />
  <meta property="og:site_name" content="Happy wedding" />

  <meta property="og:image" content="<%= data.cfg.male.bg_fb %>?v=<%= +new Date() %>" />
  <meta property="og:image:secure_url" content="<%= data.cfg.male.bg_fb %>?v=<%= +new Date() %>" />
  <meta property="og:image:width" content="1248" />
  <meta property="og:image:height" content="702" />
  <meta property="fb:admins" content="100004574107394" />
  <meta property="og:updated_time" content="<%= +new Date() %>" />
  <meta name="keywords" content='Kính mời <%= (data.invitee !== null) ? data.invitee.name : "" %>' />
  <meta name="description" content="Sự hiện diện của quý vị là niềm vinh dự lớn cho gia đình Chúng tôi" />
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/metismenu.min.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/icons.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/style.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/img.view.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/custom.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/invitation.css" rel="stylesheet" type="text/css" />
  <link href="/plugins/toastr/toastr.css" rel="stylesheet" type="text/css" />

  <style>
    .card-welcome::before {
      content: '';
      position: absolute;
      top: 0px;
      right: 0px;
      bottom: 0px;
      left: 0px;
      height: auto;
      opacity: 0.75;
      background-image: url('<%= data.cfg.male.bg %>');
      background-size: cover;
    }
  </style>

</head>


<body>

  <div id="wrapper">
    <div id="container">

      <section class="open-book">
        <div class="card-welcome-all">
          <div class="card-welcome">
            <!-- <img class="bg-top-right" src="/assets/images/right-top.png" />
            <img class="bg-bottom-left" src="/assets/images/right-top.png" /> -->


            <div class="share-buttons">
              <a style="padding-top: 5px" href="<%= data.cfg.male.location.map %>" target="_blank">
                <div class="share-button">
                  <div class="share-button-secondary">
                    <div class="share-button-secondary-content">
                      Xem Map
                    </div>
                  </div>
                  <div class="share-button-primary">
                    <i class="share-button-icon ti-location-pin"></i>
                  </div>
                </div>
              </a>
            </div>

            <div class="wrap-card-welcome">

              <div class="card-welcome-header">
                <div class="card-welcome-text vni">
                  Wedding
                </div>
                <!-- <div class="card-welcome-date">
                  <%= data.cfg.male.time_start.date.lunar.day %>
                  -
                  <%= data.cfg.male.time_start.date.lunar.month %>
                  -
                  <%= data.cfg.male.time_start.date.lunar.year %>
                </div> -->

              </div>

              <div class="card-welcome-invite-name vni">
                <%= (data.mode==2 ? "Kính mời: " + data.invitee.name
                  : "Kính mời ...................." ) %>
              </div>
            </div>

          </div>
          <div class="card-invite">
            <img class="bg-top-right" src="/assets/images/right-top.png" />
            <img class="bg-bottom-left" src="/assets/images/right-top.png" />

            <!-- <% if(data.invitee && data.invitee._id){ %>
            <a class="btn btn-primary btn-bottom-right" class="btn btn-success" href='/invocation/<%= data.invitee._id %>' target="_blank">Trả lời </a>
            <% } %> -->

            <div class="card-wrap">

              <div class="card-header-invite">
                <div class="card-header-text">
                  Trân trọng kính mời
                </div>
                <div class="card-header-inviter name vni">
                  <%= (data.mode==2 ? data.invitee.name : "Bạn và gia đình" ) %>
                </div>
                <div class="card-header-inviter">
                  Tới dự lễ thành hôn của 2 <%= (data.mode==2 ? data.invitee.level : "...." ) %>
                  <%= data.invitee.us %>
                </div>
              </div>
              <div class="card-header-name">
                <div class="male-name vni">
                  <%= data.cfg.male.name %>
                </div>
                <span style="line-height: 15px;"> &</span>
                <div class="female-name vni">
                  <%= data.cfg.female.name %>
                </div>
              </div>
              <div class="card-information">
                <span style="padding-top: 10px">Hôn lễ được tổ chức vào hồi <%=
                        data.cfg.male.time_start.time.hour %> giờ
                  <%= data.cfg.male.time_start.time.minute %>"</span>
                <div class="information-time">
                  <span class="week vni">Ngày
                  </span>
                  <span class="day btn">
                    <%= data.cfg.male.time_start.date.solar.day %>
                  </span>
                  <span class="month vni">Tháng <%= data.cfg.male.time_start.date.solar.month %>
                  </span>
                </div>
                <span class="detail-time">(Tức ngày <%= data.cfg.male.time_start.date.lunar.day
                        %>/
                  <%= data.cfg.male.time_start.date.lunar.month %> âm lịch)</span>
                <div style="padding-top:10px">Tại Nhà Trai</div>
                <div class="address">
                  <%= data.cfg.male.location.text %>
                </div>

              </div>
              <div class="end-row"> ======================</div>

              <div class="card-description">
                <span>Sự hiện diện của quý vị <br> là niềm vinh dự lớn cho gia đình Chúng
                  tôi</span>
              </div>

              <div class="wrap-footer">
                <div class="footer-information">
                  <div class="home-male">
                    <span class="footer-header vni">Nhà Trai</span>
                    <div class="family-information">
                      <p class="family-name">
                        <%= data.cfg.male.parent.father %>
                      </p>
                      <p class="family-name">
                        <%= data.cfg.male.parent.mother %>
                      </p>
                    </div>
                  </div>
                  <div class="home-female">
                    <span class="footer-header vni">Nhà Gái</span>
                    <div class="family-information">
                      <p class="family-name">
                        <%= data.cfg.female.parent.father %>
                      </p>
                      <p class="family-name">
                        <%= data.cfg.female.parent.mother %>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          </article>
          <footer>

            <ol id="page-numbers">

              <li>1</li>
              <li>2</li>

            </ol>
          </footer>
      </section>

    </div>
  </div>


  <!-- END wrapper -->
  <!-- jQuery  -->
  <script src="/assets/js/jquery.min.js"></script>
  <script src="/assets/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/js/metisMenu.min.js"></script>
  <script src="/assets/js/jquery.slimscroll.js"></script>
  <script src="/assets/js/waves.min.js"></script>

  <script src="/plugins/toastr/toastr.min.js"></script>
  <!-- App js -->
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/base/ajax.js"></script>
  <script src="/assets/js/base/notify.js"></script>
  <script src="/assets/js/live/invitation/fonts.handle.js"></script>

  <!-- FIREWORKS: canvas + lightweight fireworks script -->
  <canvas id="fireworks-canvas" style="position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:9999"></canvas>
  <script>
    (function() {
      const canvas = document.getElementById('fireworks-canvas');
      const ctx = canvas.getContext('2d');
      let w, h;

      function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resize);
      resize();

      class Particle {
        constructor(x, y, vx, vy, color, life, opts) {
          this.x = x;
          this.y = y;
          this.vx = vx;
          this.vy = vy;
          this.color = color;
          this.life = life;
          this.age = 0;
          this.px = x; // previous pos for trail
          this.py = y;
          this.size = (opts && opts.size) || 2;
          this.isRocket = opts && opts.rocket;
        }
        update(dt) {
          // lưu vị trí trước khi cập nhật để vẽ trail
          this.px = this.x;
          this.py = this.y;
          // vẫn giữ trọng lực nhẹ để rocket bắn cao, nhưng tăng tốc độ di chuyển
          this.vy += 0.045;
          // tăng hệ số nhân để di chuyển nhanh hơn
          this.x += this.vx * dt * 22;
          this.y += this.vy * dt * 22;
          this.vx *= 0.995;
          this.vy *= 0.995;
          this.age += dt;
        }
        draw(ctx) {
          ctx.globalCompositeOperation = 'lighter';
          if (this.isRocket) {
            // vẽ rocket dạng mảnh dài + hiệu ứng glow và trail
            const angle = Math.atan2(this.vy, this.vx);
            const len = Math.max(12, this.size * 6 + Math.hypot(this.vx, this.vy) * 6);
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(angle);

            // trail (faded rectangle behind rocket)
            const trailGrad = ctx.createLinearGradient(-len, 0, 0, 0);
            trailGrad.addColorStop(0, 'rgba(255,200,100,0.0)');
            trailGrad.addColorStop(0.4, 'rgba(255,160,60,0.12)');
            trailGrad.addColorStop(1, 'rgba(255,120,30,0.3)');
            ctx.fillStyle = trailGrad;
            ctx.beginPath();
            ctx.roundRect(-len, -this.size * 0.7, len * 0.9, this.size * 1.4, this.size);
            ctx.fill();

            // rocket body (bright head)
            const headGrad = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size * 4);
            headGrad.addColorStop(0, 'rgba(255,255,255,1)');
            headGrad.addColorStop(0.3, this.color || 'rgba(255,200,60,1)');
            headGrad.addColorStop(1, 'rgba(255,200,60,0.0)');
            ctx.fillStyle = headGrad;
            ctx.beginPath();
            ctx.arc(0, 0, this.size * 3.5, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();

            // subtle motion streak (line from prev to current)
            ctx.strokeStyle = 'rgba(255,200,80,0.25)';
            ctx.lineWidth = Math.max(1, this.size * 1.2);
            ctx.beginPath();
            ctx.moveTo(this.px, this.py);
            ctx.lineTo(this.x, this.y);
            ctx.stroke();

            // small glow at head position for extra brightness
            ctx.fillStyle = 'rgba(255,220,140,0.12)';
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size * 8, 0, Math.PI * 2);
            ctx.fill();

          } else {
            // explosion spark (unchanged, small circle)
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, Math.max(0.6, 2 - this.age * 0.02), 0, Math.PI * 2);
            ctx.fill();
          }
        }
      }

      const rockets = [];
      const particles = [];

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }

      // lightweight rocket that rises then explodes
      function launchTo(x, y) {
        const startX = x;
        const startY = h + 10;
        const vx = rand(-0.8, 0.8);
        // tăng magnitude của vy để rocket bắn mạnh/higher (âm lớn hơn)
        const vy = rand(-18, -28);
        // đặt target cao hơn so với điểm chạm (bắn lên chút) và không vượt quá ngưỡng trên
        const target = Math.max((y || h * 0.25) - 120, h * 0.12);
        // tạo rocket với flag để vẽ dạng elongated + trail
        rockets.push({
          p: new Particle(startX, startY, vx, vy, 'rgba(255,200,80,1)', 0, {
            rocket: true,
            size: 2
          }),
          targetY: target
        });
      }

      function explode(x, y) {
        const colors = ['#ff4d4f', '#ff7a45', '#ffd666', '#73d13d', '#36cfc9', '#40a9ff', '#9254de'];
        const count = 25 + Math.floor(rand(0, 35));
        for (let i = 0; i < count; i++) {
          const angle = Math.random() * Math.PI * 2;
          // tăng tốc độ mảnh vỡ để cảm giác mạnh mẽ hơn
          const speed = rand(2.5, 6.5);
          const vx = Math.cos(angle) * speed;
          const vy = Math.sin(angle) * speed;
          const color = colors[Math.floor(Math.random() * colors.length)];
          particles.push(new Particle(x, y, vx, vy, color, 1 + Math.random() * 1.5));
        }
      }

      let last = performance.now();

      function loop(now) {
        const dt = Math.min(0.04, (now - last) / 1000);
        last = now;
        ctx.clearRect(0, 0, w, h);

        for (let i = rockets.length - 1; i >= 0; i--) {
          const obj = rockets[i];
          const r = obj.p;
          r.update(dt);
          r.draw(ctx);
          // explode when rocket reaches targetY or slows
          if (r.y <= (obj.targetY || h * 0.25) || r.vy > -2.0) {
            explode(r.x, r.y);
            rockets.splice(i, 1);
          }
        }

        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          p.update(dt);
          const lifePct = p.age / (p.life || 1.5);
          ctx.globalAlpha = Math.max(0, 1 - lifePct);
          p.draw(ctx);
          ctx.globalAlpha = 1;
          if (p.age > (p.life * 0.9 + 0.2)) {
            particles.splice(i, 1);
          }
        }

        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);

      // AUTO LAUNCH: tự động bắn pháo hoa theo khoảng thời gian
      let autoTimer = setInterval(function() {
        // chọn vị trí ngẫu nhiên nằm trong vùng giữa màn hình
        const x = rand(w * 0.15, w * 0.85);
        const y = rand(h * 0.12, h * 0.45);
        const bursts = 1 + Math.floor(rand(0, 3)); // số rocket mỗi lần
        for (let i = 0; i < bursts; i++) {
          setTimeout(() => {
            launchTo(x + rand(-80, 80), Math.max(h * 0.12, y + rand(-60, 60)));
          }, i * 140);
        }
      }, 900);

      // giữ/huỷ timer theo trạng thái tab
      document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
          clearInterval(autoTimer);
          autoTimer = null;
        } else if (!autoTimer) {
          autoTimer = setInterval(function() {
            const x = rand(w * 0.15, w * 0.85);
            const y = rand(h * 0.12, h * 0.45);
            const bursts = 1 + Math.floor(rand(0, 3));
            for (let i = 0; i < bursts; i++) {
              setTimeout(() => {
                launchTo(x + rand(-80, 80), Math.max(h * 0.12, y + rand(-60, 60)));
              }, i * 140);
            }
          }, 900);
        }
      });

      // trigger fireworks on click or touch anywhere (canvas has pointer-events:none)
      let lastTrigger = 0;

      function triggerAt(clientX, clientY) {
        // throttle rapid taps
        const now = Date.now();
        if (now - lastTrigger < 80) return;
        lastTrigger = now;
        const rect = {
          left: 0,
          top: 0
        }; // canvas is full-window
        const x = clientX - rect.left;
        const y = clientY - rect.top;
        // launch a few rockets towards the tapped point for nicer effect
        for (let i = 0; i < 3; i++) {
          setTimeout(() => launchTo(x + rand(-30, 30), y - rand(10, 60)), i * 80);
        }
      }

      document.addEventListener('click', function(e) {
        triggerAt(e.clientX, e.clientY);
      }, {
        passive: true
      });

      document.addEventListener('touchstart', function(e) {
        if (!e.touches || e.touches.length === 0) return;
        const t = e.touches[0];
        triggerAt(t.clientX, t.clientY);
      }, {
        passive: true
      });

      // pause particle updates when not visible
      document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
          // no-op (loop will still run but particles won't be added)
        }
      });
    })();
  </script>
</body>

</html>